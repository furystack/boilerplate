---
name: Code Style
description: Formatting, naming conventions, import ordering, and file organization for the Boilerplate app
globs:
  - '**/*.ts'
  - '**/*.tsx'
alwaysApply: true
---

# Code Style Guidelines

## Formatting Standards

### Prettier Configuration

This project uses Prettier for code formatting. **Always use the project's Prettier configuration**.

**Configuration file:** `prettier.config.js`

```bash
# ✅ Good - format code
yarn prettier

# ✅ Good - check formatting
yarn prettier:check
```

### ESLint Configuration

This project uses ESLint for code quality. **Always use the project's ESLint configuration**.

**Configuration file:** `eslint.config.js`

```bash
# ✅ Good - lint code
yarn lint
```

### Automated Formatting

Code is automatically formatted on commit via Husky and lint-staged:

```json
{
  "lint-staged": {
    "*.{ts,tsx}": ["eslint --ext .tsx,.ts --cache --fix", "prettier --write", "git add"]
  }
}
```

## Naming Conventions

### Files and Directories

#### Component Files

- **Shades Components:** kebab-case file names, `.tsx` extension
- **One component per file**
- PascalCase for component exports

```
✅ Good:
frontend/src/components/theme-switch/index.tsx
frontend/src/pages/dashboard.tsx
frontend/src/components/routes/settings-routes.tsx

❌ Avoid:
frontend/src/components/ThemeSwitch.tsx (should be kebab-case for files)
frontend/src/components/user_profile.tsx
frontend/src/components/components.tsx (multiple components)
```

#### Non-Component Files

- **Utilities:** kebab-case, `.ts` extension
- **Services:** kebab-case with `-service` suffix, `.ts` extension
- **Types:** kebab-case, `.ts` extension
- **Constants:** kebab-case, `.ts` extension

```
✅ Good:
service/src/utils/format-data.ts
frontend/src/services/session.ts
common/src/models/user.ts
common/src/constants/api-endpoints.ts

❌ Avoid:
service/src/utils/FormatData.ts
frontend/src/services/Session.ts
common/src/models/User.ts
```

#### Test Files

- **Unit Tests:** `*.spec.ts` or `*.spec.tsx`
- **E2E Tests:** `*.e2e.spec.ts`
- Co-located with the file being tested

```
✅ Good:
service/src/config.ts
service/src/config.spec.ts
e2e/login.e2e.spec.ts

❌ Avoid:
service/src/config-test.ts
test/config.spec.ts (not co-located)
```

#### Directory Names

- **Component directories:** kebab-case
- **Service directories:** kebab-case
- **Module directories:** kebab-case

```
✅ Good:
frontend/src/components/theme-switch/
frontend/src/pages/user-settings/
service/src/actions/auth/
common/src/models/

❌ Avoid:
frontend/src/components/ThemeSwitch/
frontend/src/components/theme_switch/
```

### Variables and Functions

#### Variables

- **camelCase** for variables
- **UPPER_SNAKE_CASE** for constants
- Descriptive names

```typescript
// ✅ Good
const userName = 'John Doe'
const isAuthenticated = true
const userList = []
const MAX_RETRY_COUNT = 3
const API_BASE_URL = 'https://api.example.com'

// ❌ Avoid
const user_name = 'John Doe'
const User = 'John Doe'
const x = true
const maxretrycount = 3
```

#### Functions

- **camelCase** for functions
- Verb-based names
- Descriptive and clear purpose

```typescript
// ✅ Good
function getUserProfile() {}
function calculateTotal() {}
function validateEmail() {}
function handleSubmit() {}
function fetchUserData() {}

// ❌ Avoid
function user() {}
function calc() {}
function validate() {}
function submit() {}
function getData() {}
```

#### Event Handlers

- **Prefix with `handle`** for internal handlers
- **Prefix with `on`** for prop callbacks

```typescript
// ✅ Good - Shades component with event handlers
const MyComponent = Shade({
  shadowDomName: 'my-component',
  render: ({ props, injector }) => {
    const handleButtonClick = () => {
      // Internal logic
      props.onSave?.();
    };

    const handleFormSubmit = (ev: Event) => {
      ev.preventDefault();
      // Submit logic
    };

    return (
      <form onsubmit={handleFormSubmit}>
        <button onclick={handleButtonClick}>Save</button>
        <button onclick={props.onCancel}>Cancel</button>
      </form>
    );
  },
});
```

#### Boolean Variables

- Prefix with `is`, `has`, `should`, or `can`

```typescript
// ✅ Good
const isAuthenticated = true
const hasPermission = false
const shouldRender = true
const canEdit = false
const isLoading = true
const hasError = false

// ❌ Avoid
const authenticated = true
const permission = false
const render = true
const edit = false
```

### Components and Classes

- **PascalCase** for components, classes, and types
- Descriptive and clear purpose

```typescript
// ✅ Good
export const ThemeSwitch = Shade({
  /* ... */
})
export const UserProfile = Shade({
  /* ... */
})
export class SessionService {}
export type BoilerplateApi = {}

// ❌ Avoid
export const themeSwitch = Shade({
  /* ... */
}) // Wrong case
export const Component = Shade({
  /* ... */
}) // Too generic
export class sessionService {} // Wrong case
```

#### Component Props Types

- **PascalCase** with `Props` suffix
- Use `type` instead of `interface`

```typescript
// ✅ Good
type UserProfileProps = {
  userId: string;
  onEdit?: () => void;
  onDelete?: () => void;
};

export const UserProfile = Shade<UserProfileProps>({
  shadowDomName: 'user-profile',
  render: ({ props }) => {
    // Component implementation
  },
});

// ❌ Avoid
interface UserProfileProps { }  // Use type instead
type UserProfileProperties { }  // Wrong suffix
type Props { }  // Not specific enough
```

### Services and Injectables

- **PascalCase** for class names
- **Suffix with `Service`** for services
- Use `@Injectable` decorator

```typescript
// ✅ Good
@Injectable({ lifetime: 'singleton' })
export class SessionService {
  // Service implementation
}

// ❌ Avoid
export class session {} // Wrong case
export class Session {} // Missing suffix
export class SessionServiceClass {} // Redundant suffix
```

### TypeScript Types

- **PascalCase** for types and interfaces
- **Prefer `type` over `interface`**
- Descriptive names

```typescript
// ✅ Good
type User = {
  id: string
  name: string
  email: string
}

type UserWithProfile = User & {
  avatar?: string
  bio?: string
}

type RequestState<T> =
  | { status: 'idle' }
  | { status: 'loading' }
  | { status: 'success'; data: T }
  | { status: 'error'; error: string }

// ❌ Avoid
interface User {} // Use type instead (per project guidelines)
type user = {} // Wrong case
type UserType = {} // Redundant suffix
type T = {} // Not descriptive
```

### Enums and Constants

- **PascalCase** for enum names
- **UPPER_SNAKE_CASE** for enum values
- **UPPER_SNAKE_CASE** for constants

```typescript
// ✅ Good
enum UserRole {
  ADMIN = 'ADMIN',
  USER = 'USER',
  GUEST = 'GUEST',
}

const MAX_RETRY_COUNT = 3
const API_BASE_URL = 'https://api.example.com'
const DEFAULT_PORT = 9090

// ❌ Avoid
enum userRole {} // Wrong case
enum UserRole {
  admin = 'admin', // Wrong case for values
}
const maxRetryCount = 3 // Should be UPPER_SNAKE_CASE
```

## Project Structure

### Workspace Organization

```
boilerplate/
├── common/                    # Shared types and API definitions
│   ├── src/
│   │   ├── index.ts          # Main exports
│   │   ├── boilerplate-api.ts # API type definitions
│   │   └── models/           # Entity models
│   └── schemas/              # JSON schemas for validation
├── frontend/                  # Shades-based frontend
│   └── src/
│       ├── index.tsx         # App entry point
│       ├── components/       # Reusable components
│       ├── pages/            # Page components
│       └── services/         # Frontend services
├── service/                   # REST backend service
│   └── src/
│       ├── service.ts        # Service entry point
│       ├── config.ts         # Configuration
│       └── seed.ts           # Database seeding
└── e2e/                       # End-to-end tests
    └── page.spec.ts
```

### Component File Structure

Components should be organized in directories when they have assets:

```
components/
├── theme-switch/
│   └── index.tsx             # Component with no assets
├── github-logo/
│   ├── index.tsx             # Component
│   ├── gh-dark.png           # Dark theme asset
│   └── gh-light.png          # Light theme asset
└── header.tsx                 # Simple component (no directory needed)
```

## Import Ordering and Grouping

### Import Order

Group imports in the following order:

1. **Node built-ins**
2. **External dependencies** (npm packages)
3. **FuryStack packages** (`@furystack/*`)
4. **Workspace packages** (`common`)
5. **Relative imports**
6. **Type imports** (if separated)

```typescript
// ✅ Good - organized imports
import { EventEmitter } from 'events'

import { createComponent, Shade } from '@furystack/shades'
import { Injector } from '@furystack/inject'

import type { BoilerplateApi } from 'common'

import { SessionService } from '../services/session.js'
import type { UserProps } from './types.js'

// ❌ Avoid - random ordering
import { SessionService } from '../services/session.js'
import { EventEmitter } from 'events'
import { Injector } from '@furystack/inject'
```

### Import Grouping with Blank Lines

Separate import groups with blank lines:

```typescript
// ✅ Good - separated groups
import { Injectable } from '@furystack/inject'
import { Shade } from '@furystack/shades'

import { Cache } from '@furystack/cache'

import type { User } from 'common'

import { SessionService } from '../services/session.js'

import { UserAvatar } from './components/user-avatar.js'
```

### Named Imports

Use named imports and group them logically:

```typescript
// ✅ Good - grouped FuryStack imports
import { Injectable, Injected } from '@furystack/inject'
import { ObservableValue, usingAsync } from '@furystack/utils'

// ✅ Good - alphabetically sorted when many imports
import { Cache } from '@furystack/cache'
import { getCurrentUser } from '@furystack/core'
import { getLogger } from '@furystack/logging'
import { JsonResult, RequestError } from '@furystack/rest-service'

// ❌ Avoid - separate imports for same package
import { Injectable } from '@furystack/inject'
import { Injected } from '@furystack/inject'
```

## Code Organization Within Files

### Service Class Structure

```typescript
// ✅ Good - organized service
@Injectable({ lifetime: 'singleton' })
export class SessionService {
  // 1. Injected dependencies
  @Injected(ApiClient)
  declare private apiClient: ApiClient

  // 2. Public properties
  public currentUser = new ObservableValue<User | null>(null)

  // 3. Constructor (if needed)
  constructor() {
    this.init()
  }

  // 4. Public methods
  public async login(credentials: Credentials): Promise<void> {
    // Implementation
  }

  // 5. Private methods
  private async init(): Promise<void> {
    // Implementation
  }

  // 6. Disposal
  public [Symbol.dispose](): void {
    // Cleanup
  }
}
```

### Component File Structure

```typescript
// 1. Imports
import { Shade } from '@furystack/shades';
import { ObservableValue } from '@furystack/utils';

import type { User } from 'common';

// 2. Types
type UserProfileProps = {
  userId: string;
  onEdit?: () => void;
};

// 3. Constants (if any)
const MAX_BIO_LENGTH = 500;

// 4. Helper functions (if any)
const formatDate = (date: Date): string => {
  // ...
};

// 5. Main component
export const UserProfile = Shade<UserProfileProps>({
  shadowDomName: 'user-profile',
  render: ({ props, injector, useObservable, useDisposable }) => {
    // Services
    const userService = injector.getInstance(UserService);

    // Observable subscriptions
    const [user] = useObservable('user', userService.getUserById(props.userId));

    // Local state
    const isEditing = useDisposable('isEditing', () => new ObservableValue(false));
    const error = useDisposable('error', () => new ObservableValue(''));

    // Handlers
    const handleEditClick = () => {
      isEditing.setValue(true);
      props.onEdit?.();
    };

    // Render
    return (
      <div data-testid="user-profile">
        {/* Component content */}
      </div>
    );
  },
});
```

## JSX/TSX Code Style

### JSX Formatting

```tsx
// ✅ Good - multi-line for readability
<button
  type="button"
  onclick={handleClick}
  style={{ padding: '8px 16px' }}
>
  Save Changes
</button>

// ✅ Good - single line for simple cases
<button onclick={handleClick}>Save</button>

// ❌ Avoid - hard to read
<button type="button" onclick={handleClick} style={{ padding: '8px 16px' }}>Save Changes</button>
```

### Conditional Rendering

```tsx
// ✅ Good - logical AND for simple cases
{
  isLoading && <div>Loading...</div>
}

// ✅ Good - ternary for if-else
{
  isLoading ? <div>Loading...</div> : <div>Content</div>
}

// ✅ Good - early return for complex cases
if (isLoading) return <div>Loading...</div>
if (error) return <div>Error: {error}</div>
return <div>Content</div>

// ❌ Avoid - nested ternaries
{
  isLoading ? <div>Loading...</div> : error ? <div>Error</div> : <div>Content</div>
}
```

## Comments and Documentation

### JSDoc for Functions

```typescript
/**
 * Formats a currency value with the specified currency code
 * @param value - The numeric value to format
 * @param currency - The ISO currency code (e.g., 'USD', 'EUR')
 * @returns Formatted currency string
 */
export const formatCurrency = (value: number, currency: string): string => {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency,
  }).format(value)
}
```

### Component Documentation

```typescript
/**
 * UserProfile component displays user information and allows editing
 */
export const UserProfile = Shade<UserProfileProps>({
  shadowDomName: 'user-profile',
  render: ({ props }) => {
    // Component implementation
  },
})
```

### Inline Comments

Use inline comments sparingly and only for complex logic:

```typescript
// ✅ Good - explaining complex logic
// Calculate exponential backoff: 1s, 2s, 4s, 8s...
const delay = Math.min(1000 * 2 ** attempt, 30000)

// ❌ Avoid - stating the obvious
// Set count to 0
const count = 0
```

## Summary

**Key Principles:**

1. **Follow project's Prettier and ESLint configs**
2. **Use consistent naming conventions:**
   - PascalCase: Components, services, types
   - camelCase: Variables, functions
   - kebab-case: File names
   - UPPER_SNAKE_CASE: Constants
3. **Organize files logically** with direct imports
4. **Order imports** by category with blank lines (Node → External → FuryStack → Common → Local)
5. **Structure components** consistently (services → observables → handlers → render)
6. **Be explicit** with TypeScript where it adds clarity
7. **Format JSX** for readability
8. **Document** complex logic and public APIs

**Tools:**

- Prettier: `yarn format`
- ESLint: `yarn lint`
- Type Check: `yarn build`
- Unit Tests: `yarn test`
- E2E Tests: `yarn test:e2e`
